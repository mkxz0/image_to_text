â€<!DOCTYPE html>
â€<html lang="ar" dir="rtl">
â€<head>
â€  <meta charset="utf-8" />
â€  <meta name="viewport" content="width=device-width,initial-scale=1" />
â€  <title>AI-Assisted Mining â€” Prediction + Local Search (Local Gemini Key)</title>
â€  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
â€  <style>
â€    :root{--bg:#070708;--card:#0f1315;--fg:#e6f7ff;--accent:#22d3ee;--mut:#9fb0b8}
â€    *{box-sizing:border-box}
â€    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
â€    .wrap{max-width:980px;margin:12px auto;padding:14px}
â€    h1{color:var(--accent);margin:6px 0;font-size:20px;text-align:center}
â€    .card{background:var(--card);border-radius:12px;padding:12px;margin:10px 0;box-shadow:0 1px 0 #000 inset}
â€    label{display:block;font-size:13px;color:var(--mut);margin-bottom:6px}
â€    input,select,button,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #122;background:#071011;color:var(--fg);font-size:14px}
â€    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
â€    @media(max-width:720px){ .grid{grid-template-columns:1fr} }
â€    .row{display:flex;gap:8px}
â€    .row button{flex:1}
â€    button.primary{background:linear-gradient(90deg,#22d3ee,#60a5fa);color:#001;font-weight:700}
â€    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;direction:ltr}
â€    table{width:100%;border-collapse:collapse;margin-top:8px}
â€    th,td{padding:8px;border:1px solid #112;text-align:center}
â€    th{background:#062e2f}
â€    .muted{color:var(--mut);font-size:13px}
â€    .small{font-size:13px}
â€    .ok{color:#9ffb9f}
â€  </style>
â€</head>
â€<body>
â€<div class="wrap">
â€  <h1>ØªØ¹Ø¯ÙŠÙ† Ø¨Ù…Ø³Ø§Ø¹Ø¯Ø© AI â€” ØªØ®Ù…ÙŠÙ† Nonce Ø«Ù… Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠ</h1>

â€  <div class="card">
â€    <div class="grid">
â€      <div>
â€        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªÙ„Ø© (Header)</label>
â€        <input id="header" value="BlockHeaderExample" />
â€      </div>
â€      <div>
â€        <label>Ø£ØµÙØ§Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (ØµØ¹ÙˆØ¨Ø© Ø¨Ø§Ù„Ù€ hex)</label>
â€        <input id="zeros" type="number" min="1" max="7" value="4" />
â€      </div>
â€      <div>
â€        <label>Ù†Ø·Ø§Ù‚ Nonce (0..N)</label>
â€        <input id="nonceCap" type="number" value="10000000" />
â€      </div>
â€      <div>
â€        <label>Ø­Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠ (Safety)</label>
â€        <input id="maxLocal" type="number" value="200000" />
â€      </div>
â€    </div>

â€    <div style="margin-top:10px" class="grid">
â€      <div>
â€        <label>Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø­ÙˆÙ„ Ø§Ù„ØªØ®Ù…ÙŠÙ† (radius)</label>
â€        <input id="radius" type="number" value="5000" />
â€      </div>
â€      <div>
â€        <label>top-K (Ø¹Ù†Ø¯ ÙØ´Ù„ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„)</label>
â€        <input id="topk" type="number" value="8" />
â€      </div>
â€    </div>

â€    <div style="margin-top:10px" class="muted small">Ø³ÙŠØªÙ…: (1) Ø·Ù„Ø¨ ØªØ®Ù…ÙŠÙ† ÙˆØ§Ø­Ø¯ Ù…Ù† GeminiØŒ (2) Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù…Ù† Ø§Ù„ØªØ®Ù…ÙŠÙ†ØŒ (3) Ø¨Ø­Ø« Ù…Ø­Ù„ÙŠ Â±radiusØŒ (4) Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ Ù†Ø·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© top-K ÙˆÙ†ÙƒØ±Ø±.</div>
â€  </div>

â€  <div class="card">
â€    <label>Ù…ÙØªØ§Ø­ Gemini (Ø³ÙŠÙØ¶Ù…ÙÙ‘Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø·Ù„Ø¨ â€” Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙØ­Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙ‚Ø·)</label>
â€    <input id="geminiKey" value="AIzaSyCA4sXqUz7W3EU70wEZQ6_ttdL6osBlm4E" />
â€    <div class="muted small">ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ: Ø­ØªÙ‰ Ù„Ùˆ Ù†Ø§ÙØ°Ø© Ù…Ø­Ù„ÙŠØ©ØŒ Ø§Ø­ØªÙØ¸ Ø¨Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† ÙˆØºÙŠÙ‘Ø±Ù‡ Ø¥Ø°Ø§ Ù„Ø²Ù….</div>
â€  </div>

â€  <div class="card">
â€    <div class="row">
â€      <button id="btnRun" class="primary">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø¯ÙˆØ±Ø© AI-Prediction + Local Search</button>
â€      <button id="btnRunRand">ğŸ” ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Baseline)</button>
â€      <button id="btnClear">ğŸ§¹ ØªÙØ±ÙŠØº Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
â€    </div>
â€    <div style="margin-top:8px" class="muted small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø®ØªØ± ØµØ¹ÙˆØ¨Ø© ØµØºÙŠØ±Ø© (3â€“4) Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ Ù„Ø¶Ù…Ø§Ù† Ù†ØªØ§Ø¦Ø¬ ÙÙŠ ÙˆÙ‚Øª Ù…Ø¹Ù‚ÙˆÙ„.</div>
â€  </div>

â€  <div class="card">
â€    <div id="log" class="mono small" style="max-height:260px;overflow:auto"></div>
â€    <div id="out"></div>
â€  </div>
â€</div>

â€<script>
â€// ---------- Utilities ----------
â€const $ = id => document.getElementById(id);
â€function appendLog(s){ const d=document.createElement('div'); d.innerHTML=s; $('log').appendChild(d); $('log').scrollTop = $('log').scrollHeight; }
â€function clearOut(){ $('out').innerHTML=''; }
â€function clearLog(){ $('log').innerHTML=''; }

â€// ---------- Double SHA-256 via WebCrypto ----------
â€async function doubleSha256Hex(str){
â€  const enc = new TextEncoder();
â€  const first = await crypto.subtle.digest('SHA-256', enc.encode(str));
â€  const first8 = new Uint8Array(first);
â€  const second = await crypto.subtle.digest('SHA-256', first8);
â€  return Array.from(new Uint8Array(second)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
â€function meetsDifficulty(hexHash, zeros){ for(let i=0;i<zeros;i++){ if(hexHash[i] !== '0') return false; } return true; }

â€// ---------- Gemini API direct calls (single guess + topK) ----------
â€const GEMINI_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
â€async function geminiSingleGuess(header, zeros, key, nonceCap){
â€  const prompt = `You are assisting a cryptographic experiment. Given header = "${header}" and the requirement that double-SHA256(header + '|' + nonce) must start with ${zeros} hex zeros, return a single integer nonce (0..${nonceCap}) that is most likely to satisfy the condition. Return ONLY a JSON integer like: 123456. Do NOT include explanations.`;
â€  const body = { contents:[{ parts:[{ text: prompt }]}] };
â€  const t0 = performance.now();
â€  const res = await fetch(GEMINI_URL, { method:'POST', headers:{ 'Content-Type':'application/json', 'X-goog-api-key': key }, body: JSON.stringify(body) });
â€  const text = await res.text();
â€  const latency = performance.now() - t0;
â€  // extract first integer
â€  const m = text.match(/-?\d+/);
â€  if(!m) throw new Error('No integer returned by Gemini');
â€  return { guess: (Number(m[0])>>>0), raw: text, latency };
}
â€async function geminiTopK(header, zeros, key, nonceCap, K){
â€  const prompt = `Return a JSON array of up to ${K} integers (0..${nonceCap}) that are most likely to satisfy: double-SHA256(header + '|' + nonce) starts with ${zeros} hex zeros. Respond ONLY with a JSON array like: [123,456,...]. No other text.`;
â€  const body = { contents:[{ parts:[{ text: prompt }]}] };
â€  const t0 = performance.now();
â€  const res = await fetch(GEMINI_URL, { method:'POST', headers:{ 'Content-Type':'application/json', 'X-goog-api-key': key }, body: JSON.stringify(body) });
â€  const text = await res.text();
â€  const latency = performance.now() - t0;
â€  const m = text.match(/\[(?:.|\n)*?\]/);
â€  if(!m) throw new Error('No array returned by Gemini');
â€  try{ const arr = JSON.parse(m[0]); return { arr: arr.map(x=>Number(x)>>>0), raw:text, latency }; } catch(e){ throw new Error('Failed to parse Gemini array'); }
}

â€// ---------- Local search around guess ----------
â€async function localSearchAround(header, guess, zeros, radius, nonceCap, limitLocal){
â€  // Check guess then expand Â±d
â€  let attempts = 0;
â€  function safe(n){ return n >= 0 && n <= nonceCap; }
â€  // check single nonce
â€  if(safe(guess)){
â€    attempts++;
â€    const h = await doubleSha256Hex(header + '|' + guess);
â€    if(meetsDifficulty(h, zeros)) return { found: guess, hash: h, attempts };
  }
â€  for(let d=1; d<=radius; d++){
â€    const a = guess + d;
â€    if(a <= nonceCap){ attempts++; const h = await doubleSha256Hex(header + '|' + a); if(meetsDifficulty(h, zeros)) return { found: a, hash: h, attempts }; }
â€    const b = guess - d;
â€    if(b >= 0){ attempts++; const h = await doubleSha256Hex(header + '|' + b); if(meetsDifficulty(h, zeros)) return { found: b, hash: h, attempts }; }
â€    if(attempts >= limitLocal) break;
â€    if((d & 0x3ff) === 0) await new Promise(r=>setTimeout(r,0)); // yield
  }
â€  return { found: null, attempts };
}

â€// ---------- Main cycle: AI guess -> local search -> topK fallback ----------
â€async function runAICycle(){
â€  clearLog(); clearOut(); appendLog('<b>â–¶ï¸ Ø¨Ø¯Ø¡ Ø¯ÙˆØ±Ø© AI Prediction + Local Search</b>');
â€  const header = $('header').value.trim(); const zeros = Number($('zeros').value)||3; const nonceCap = Number($('nonceCap').value)||10000000; const radius = Number($('radius').value)||5000; const topk = Number($('topk').value)||8; const maxLocal = Number($('maxLocal').value)||200000; const key = $('geminiKey').value.trim();

â€  const metrics = { api_calls:0, api_latency_ms:0, local_attempts:0, total_time_ms:0 };
â€  const tStart = performance.now();

â€  try{
â€    // 1) single guess
â€    appendLog('Ø·Ù„Ø¨ ØªØ®Ù…ÙŠÙ† ÙˆØ§Ø­Ø¯ Ù…Ù† Gemini...');
â€    metrics.api_calls++;
â€    const gRes = await geminiSingleGuess(header, zeros, key, nonceCap);
â€    metrics.api_latency_ms += gRes.latency;
â€    appendLog(`Gemini â†’ guess = <span class="mono">${gRes.guess}</span> (latency ${gRes.latency.toFixed(0)} ms)`);

â€    // 2) local search around guess
â€    appendLog(`Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø­ÙˆÙ„ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø¨Ù…Ø¯Ù‰ radius=${radius} ...`);
â€    const local1 = await localSearchAround(header, gRes.guess, zeros, radius, nonceCap, maxLocal);
â€    metrics.local_attempts += local1.attempts;
â€    if(local1.found){
â€      const total = performance.now()-tStart; metrics.total_time_ms = total;
â€      appendLog(`<b class="ok">âœ… Ù†Ø¬Ø­ AI! nonce=${local1.found} â€” hash=${local1.hash.slice(0,20)}â€¦</b>`);
â€      appendResults('AI (single guess + local search) â€” Ù†Ø¬Ø§Ø­', gRes, local1, metrics);
â€      return;
    }

â€    appendLog('Ù„Ù… ÙŠÙ†Ø¬Ø­ Ø§Ù„ØªØ®Ù…ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„ â€” Ù†Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† Ù‚Ø§Ø¦Ù…Ø© top-K Ù…Ù† Gemini...');
â€    // 3) top-K fallback
â€    metrics.api_calls++;
â€    const topRes = await geminiTopK(header, zeros, key, nonceCap, topk);
â€    metrics.api_latency_ms += topRes.latency;
â€    appendLog(`Gemini â†’ topK (latency ${topRes.latency.toFixed(0)} ms): <span class="mono">[${topRes.arr.join(', ')}]</span>`);

â€    // 4) iterate topK with smaller radius
â€    const smallRadius = Math.min(1000, Math.floor(radius/5));
â€    for(const cand of topRes.arr){
â€      appendLog(`Ø§Ù„ØªØ­Ù‚Ù‚ Ø­ÙˆÙ„ Ø§Ù„Ù…Ø±Ø´Ø­ ${cand} (Â±${smallRadius}) ...`);
â€      const res = await localSearchAround(header, cand, zeros, smallRadius, nonceCap, Math.max(5000, Math.floor(maxLocal/topk)) );
â€      metrics.local_attempts += res.attempts;
â€      if(res.found){
â€        const total = performance.now()-tStart; metrics.total_time_ms = total;
â€        appendLog(`<b class=ok>âœ… Ù†Ø¬Ø­ AI Ø¹Ø¨Ø± top-K! nonce=${res.found} â€” hash=${res.hash.slice(0,20)}â€¦</b>`);
â€        appendResults('AI (topK fallback) â€” Ù†Ø¬Ø§Ø­', {guessList: topRes.arr}, res, metrics);
â€        return;
      }
    }

    // 5) ÙØ´Ù„ ÙƒØ§Ù…Ù„ â€” Ø§Ù„Ø¹Ø±Ø¶
â€    metrics.total_time_ms = performance.now()-tStart;
â€    appendLog('<span class="muted">â„¹ï¸ ÙØ´Ù„ AI ÙÙŠ Ø¥ÙŠØ¬Ø§Ø¯ Ø­Ù„ Ø¶Ù…Ù† Ø§Ù„Ù‚ÙŠÙˆØ¯. ØªÙ†ÙÙŠØ° Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙƒÙ€ baseline ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ù‡.</span>');
â€    appendResults('AI â€” ÙØ´Ù„', {guess: gRes.guess, raw:gRes.raw}, {found:null, attempts:metrics.local_attempts}, metrics);
â€  }catch(err){
â€    appendLog(`<span style="color:#ff8a8a">âŒ Ø®Ø·Ø£: ${err.message}</span>`);
  }
}

â€// ---------- Random baseline ----------
â€async function runRandomBaseline(){
â€  clearLog(); clearOut(); appendLog('â–¶ï¸ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ† Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Baseline)');
â€  const header = $('header').value.trim(); const zeros = Number($('zeros').value)||3; const nonceCap = Number($('nonceCap').value)||10000000; const maxLocal = Number($('maxLocal').value)||200000; setTimeout(()=>{},0);
â€  const t0 = performance.now(); let attempts = 0; let found=null; let foundHash='';
â€  while(attempts < maxLocal){
â€    const nonce = Math.floor(Math.random()*nonceCap);
â€    attempts++;
â€    const h = await doubleSha256Hex(header + '|' + nonce);
â€    if(meetsDifficulty(h, zeros)){ found = nonce; foundHash = h; break; }
â€    if((attempts & 0x3ff) === 0) await new Promise(r=>setTimeout(r,0));
  }
â€  const t1 = performance.now(); appendLog(`Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${attempts}, Ø²Ù…Ù†: ${(t1-t0).toFixed(1)} ms`);
â€  if(found){ appendLog(`<b class=ok>âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ nonce=${found} â€” hash=${foundHash.slice(0,24)}â€¦</b>`); appendResults('Random Baseline', {}, {found, attempts}, {total_time_ms: t1-t0}); }
â€  else { appendLog('<span class="muted">â€“ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ù„ Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯</span>'); appendResults('Random Baseline â€” no result', {}, {found:null, attempts}, {total_time_ms: t1-t0}); }
}

â€// ---------- UI result rendering ----------
â€function appendResults(title, guessInfo, localInfo, metrics){
â€  const out = document.createElement('div'); out.innerHTML = `<h3 style="margin:8px 0 4px">${title}</h3>`;
â€  const table = document.createElement('table'); table.innerHTML = `
â€    <thead><tr><th>Ø§Ù„Ø¨Ù†Ø¯</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr></thead>
â€    <tbody>
â€      <tr><td>API calls</td><td class="mono">${metrics.api_calls??0}</td></tr>
â€      <tr><td>API latency (ms)</td><td class="mono">${metrics.api_latency_ms?.toFixed(1)??0}</td></tr>
â€      <tr><td>Local attempts</td><td class="mono">${metrics.local_attempts??localInfo.attempts??0}</td></tr>
â€      <tr><td>Total time (ms)</td><td class="mono">${(metrics.total_time_ms||0).toFixed(1)}</td></tr>
â€      <tr><td>Nonce found</td><td class="mono">${localInfo.found??'â€”'}</td></tr>
â€      <tr><td>Hash (prefix)</td><td class="mono">${localInfo.hash?localInfo.hash.slice(0,24)+'â€¦':'â€”'}</td></tr>
â€    </tbody>
  `;
â€  out.appendChild(table);
â€  $('out').appendChild(out);
â€  $('out').scrollTop = $('out').scrollHeight;
}

â€// ---------- wiring ----------
â€$('btnRun').onclick = ()=>{ runAICycle(); };
â€$('btnRunRand').onclick = ()=>{ runRandomBaseline(); };
â€$('btnClear').onclick = ()=>{ clearLog(); clearOut(); };

â€// Convenience: focus header on load
â€$('header').focus();
â€</script>
â€</body>
â€</html>
